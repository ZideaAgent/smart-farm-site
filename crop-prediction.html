<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartFarm - Crop Prediction</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">
                <div class="logo">
                    <i class="fas fa-leaf"></i>
                    <span>SmartFarm</span>
                </div>
            </a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="dashboard.html">Dashboard</a>
                <a href="pump.html">Pump Control</a>
                <a href="crop-prediction.html" class="active">Crop Prediction</a>
                <a href="disease-detection.html">Disease Detection</a>
                <a href="about.html">About Us</a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-gray-800 mb-8 flex items-center">
                <i class="fas fa-seedling text-green-500 mr-3"></i>
                Crop Recommendation System
            </h1>

            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <form id="cropPredictionForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Nitrogen -->
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Nitrogen (N)
                                <i class="fas fa-info-circle text-gray-400 ml-1" title="Nitrogen content in soil (0-140)"></i>
                            </label>
                            <input type="number" id="nitrogen" name="nitrogen" min="0" max="140" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>

                        <!-- Phosphorus -->
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Phosphorus (P)
                                <i class="fas fa-info-circle text-gray-400 ml-1" title="Phosphorus content in soil (5-145)"></i>
                            </label>
                            <input type="number" id="phosphorus" name="phosphorus" min="5" max="145" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>

                        <!-- Potassium -->
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Potassium (K)
                                <i class="fas fa-info-circle text-gray-400 ml-1" title="Potassium content in soil (5-205)"></i>
                            </label>
                            <input type="number" id="potassium" name="potassium" min="5" max="205" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>

                        <!-- Temperature -->
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Temperature (Â°C)
                                <i class="fas fa-info-circle text-gray-400 ml-1" title="Temperature in Celsius (8-44)"></i>
                            </label>
                            <input type="number" id="temperature" name="temperature" min="8" max="44" step="0.1" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>

                        <!-- pH -->
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                pH Level
                                <i class="fas fa-info-circle text-gray-400 ml-1" title="Soil pH level (3.5-10)"></i>
                            </label>
                            <input type="number" id="ph" name="ph" min="3.5" max="10" step="0.1" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>

                        <!-- Rainfall -->
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Rainfall (mm)
                                <i class="fas fa-info-circle text-gray-400 ml-1" title="Annual rainfall in mm (20-300)"></i>
                            </label>
                            <input type="number" id="rainfall" name="rainfall" min="20" max="300" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>

                    <div class="flex justify-center">
                        <button type="submit" class="btn btn-primary flex items-center">
                            <i class="fas fa-magic mr-2"></i>
                            Get Crop Recommendations
                        </button>
                    </div>
                </form>
            </div>

            <!-- Loading Spinner -->
            <div id="loadingSpinner" class="hidden">
                <div class="flex justify-center items-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"></div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Recommended Crops</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="cropResults">
                    <!-- Results will be dynamically inserted here -->
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-4" role="alert">
                <span class="block sm:inline"></span>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('cropPredictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Show loading spinner
            document.getElementById('loadingSpinner').classList.remove('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('errorMessage').classList.add('hidden');

            // Get form data
            const formData = {
                N: parseFloat(document.getElementById('nitrogen').value),
                P: parseFloat(document.getElementById('phosphorus').value),
                K: parseFloat(document.getElementById('potassium').value),
                temperature: parseFloat(document.getElementById('temperature').value),
                ph: parseFloat(document.getElementById('ph').value),
                rainfall: parseFloat(document.getElementById('rainfall').value)
            };

            try {
                const response = await fetch('https://crop-recommender-h2cnb6bueee4gsh3.uaenorth-01.azurewebsites.net/predict_crop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error('Failed to get predictions');
                }

                const responseData = await response.json();
                const data = responseData.predictions; // Access the 'predictions' array
                
                // Display results
                const resultsContainer = document.getElementById('cropResults');
                resultsContainer.innerHTML = '';

                data.forEach((crop, index) => {
                    const probability = (crop.probability * 100).toFixed(1);
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-lg shadow-md p-6 transform transition-transform hover:scale-105';
                    card.innerHTML = `
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-semibold text-gray-800">${crop.crop}</h3>
                            <span class="text-2xl font-bold text-green-500">${probability}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="bg-green-500 h-2.5 rounded-full" style="width: ${probability}%"></div>
                        </div>
                    `;
                    resultsContainer.appendChild(card);
                });

                document.getElementById('resultsSection').classList.remove('hidden');
            } catch (error) {
                document.getElementById('errorMessage').classList.remove('hidden');
                let errorMessageText = 'Failed to get crop predictions. Please try again.';
                if (error.response && error.response.json) {
                    try {
                        const errorData = await error.response.json();
                        if (errorData.detail) {
                            errorMessageText = `API Error: ${errorData.detail}`;
                        } else if (errorData.message) {
                            errorMessageText = `API Error: ${errorData.message}`;
                        } else {
                            errorMessageText = `API Error: ${JSON.stringify(errorData)}`;
                        }
                    } catch (jsonError) {
                        errorMessageText = `Network Error: ${error.message}`;
                    }
                } else {
                    errorMessageText = `Network Error: ${error.message}`;
                }
                document.getElementById('errorMessage').querySelector('span').textContent = errorMessageText;
            } finally {
                document.getElementById('loadingSpinner').classList.add('hidden');
            }
        });
    </script>
</body>
</html> 